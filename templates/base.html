<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Cluster Transcode Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css">
  <style>
        html, body {
            font-family: monospace;
            /* Define CSS variables for theming */
            --bg-color: #f0f4f8;
            --text-color: #212529;
            --nav-bg: linear-gradient(to right, #1f1f70, #3f3fbf);
            --nav-text-color: white;
            --section-bg-color: #eef2f7;
            --section-border-color: #ccc;
            --primary-color: #1f1f70;
            --card-bg-color: #fff;
            --table-border-color: #ddd;
            --table-header-bg: #f9f9f9;
            --lagging-color: #6c757d;
            --progress-bar-bg: #e9ecef;
        }

        /* Dark mode overrides */
        html.dark-mode, body.dark-mode {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --nav-bg: linear-gradient(to right, #1a1a1a, #2c2c2c);
            --section-bg-color: #1e1e1e;
            --section-border-color: #444;
            --primary-color: #bb86fc;
            --card-bg-color: #1e1e1e;
            --table-border-color: #444;
            --table-header-bg: #2a2a2a;
            --lagging-color: #888;
            --progress-bar-bg: #333;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        /* Navigation bar */
        nav {
            background: var(--nav-bg);
            color: var(--nav-text-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        nav .app-name { font-weight: bold; font-size: 1.2em; }
        nav a { color: white; text-decoration: none; font-weight: bold; }
        nav a:hover { text-decoration: underline; }

        /* Main content container */
        .content-container {
            max-width: 1400px;
            width: 95%;
            margin: 30px auto;
            padding: 25px;
            background-color: var(--card-bg-color);
            border: 1px solid var(--section-border-color);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            flex: 1;
        }
  </style>
  {% block head %}{% endblock %}
</head>
<body>
  <nav>
    <div class="app-name"><a href="/"><span class="mdi mdi-server-network"></span> Cluster Dashboard</a></div>
    <div>
      <button id="theme-toggle" title="Change Theme" style="margin-left: 5px; background: none; border: none; color: white; cursor: pointer; padding: 0 8px; font-size: 24px; vertical-align: middle;">
          <span class="mdi mdi-brightness-6"></span>
      </button>
    </div>
  </nav>

  <div class="content-container">
    {% block content %}{% endblock %}
  </div>

<script>
    const themeToggle = document.getElementById('theme-toggle');
    const themes = ['light', 'dark', 'system'];
    const icons = ['mdi-brightness-5', 'mdi-brightness-3', 'mdi-brightness-auto'];
    let currentThemeIndex = 0;

    function applyTheme(theme) {
        if (theme === 'dark') {
            document.documentElement.classList.add('dark-mode');
        } else {
            document.documentElement.classList.remove('dark-mode');
        }
    }

    function handleSystemTheme() {
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(systemPrefersDark ? 'dark' : 'light');
    }

    function setInitialTheme() {
        const savedTheme = localStorage.getItem('theme') || 'system';
        currentThemeIndex = themes.indexOf(savedTheme);
        
        if (savedTheme === 'system') {
            handleSystemTheme();
        } else {
            applyTheme(savedTheme);
        }
        themeToggle.title = `Theme: ${savedTheme.charAt(0).toUpperCase() + savedTheme.slice(1)}`;
        themeToggle.querySelector('span').className = `mdi ${icons[currentThemeIndex]}`;
    }

    themeToggle.addEventListener('click', () => {
        currentThemeIndex = (currentThemeIndex + 1) % themes.length;
        const newTheme = themes[currentThemeIndex];
        localStorage.setItem('theme', newTheme);

        if (newTheme === 'system') {
            handleSystemTheme();
        } else {
            applyTheme(newTheme);
        }
        themeToggle.title = `Theme: ${newTheme.charAt(0).toUpperCase() + newTheme.slice(1)}`;
        themeToggle.querySelector('span').className = `mdi ${icons[currentThemeIndex]}`;
    });

    // Listen for changes in OS theme preference
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', handleSystemTheme);

    // Set the initial theme on page load
    setInitialTheme();
</script>
</body>
</html>