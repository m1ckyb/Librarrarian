{% extends "base.html" %}

{% block head %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block page_title %}
    <h2>Worker Options</h2>
{% endblock %}

{% block content %}
    <a href="/" class="btn btn-outline-secondary mb-3">Back to Dashboard</a>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" action="/options" class="mt-4">
        <!-- Rescan Delay Setting -->
        <div class="mb-4 p-3 border rounded">
            <label for="rescan_delay_minutes" class="form-label"><strong>Rescan Delay</strong></label>
            <p class="form-text">The delay in minutes after a scan finds files before starting a new scan. 0 means immediate.</p>
            <div class="d-flex align-items-center">
                <input type="range" class="form-range" min="0" max="60" step="1" id="rescan_delay_minutes" name="rescan_delay_minutes" value="{{ settings.get('rescan_delay_minutes', {}).get('value', 0) | int }}">
                <span id="delay-value" class="badge bg-primary ms-3" style="width: 60px;">{{ settings.get('rescan_delay_minutes', {}).get('value', 0) | int }} min</span>
            </div>
        </div>

        <!-- Skip Encoded Folder Setting -->
        <div class="mb-4 p-3 border rounded">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="skip_encoded_folder" name="skip_encoded_folder" value="true" {{ 'checked' if settings.get('skip_encoded_folder', {}).get('value') == 'true' }}>
                <label class="form-check-label" for="skip_encoded_folder"><strong>Skip 'encoded' Folders</strong></label>
            </div>
            <p class="form-text">If enabled, the worker will completely ignore any directory named "encoded" and will not scan it for files.</p>
        </div>

        <button type="submit" class="btn btn-primary">Save Settings</button>
    </form>
{% endblock %}

{% block scripts %}
    <script>
        const delaySlider = document.getElementById('rescan_delay_minutes');
        const delayValue = document.getElementById('delay-value');
        delaySlider.addEventListener('input', (event) => {
            delayValue.textContent = `${event.target.value} min`;
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}